"use strict";
var Promise = require("bluebird");
var lsdisks = require("ls-disks");
var child_process = require("child_process");
function checkpart(part) {
    var disks = lsdisks.all();
    var thepartition;
    var exists = false;
    for (var d = 0; d < disks.length; d++) {
        for (var p = 0; p < disks[d].partitions.length; p++) {
            if (disks[d].partitions[p].name === part || disks[d].partitions[p].partition === part || disks[d].partitions[p].label === part) {
                thepartition = disks[d].partitions[p];
                exists = true;
            }
        }
    }
    if (exists) {
        return thepartition;
    }
    else {
        throw Error("partition " + part + " not founded");
    }
}
function mount(part, dir) {
    return new Promise(function (resolve, reject) {
        var parti;
        try {
            parti = checkpart(part);
        }
        catch (err) {
            reject(err);
        }
        child_process.exec("mount " + parti.partition + " " + dir, function (err, stdout, stderr) {
            if (err) {
                reject(err);
            }
            else {
                resolve(true);
            }
        });
    });
}
exports.mount = mount;
function umount(dirOrPart) {
    return new Promise(function (resolve, reject) {
        child_process.exec("cat /etc/mtab | grep -c '" + dirOrPart + "'", function (err, stdout, stderr) {
            if (err) {
                reject(err);
            }
            else if (parseInt(stdout) > 0) {
                child_process.exec("ummount " + dirOrPart, function (err, stdout, stderr) {
                    if (err) {
                        reject(err);
                    }
                    else {
                        resolve(true);
                    }
                });
            }
            else {
                reject("not mounted");
            }
        });
    });
}
exports.umount = umount;
function remount(part, mode, otheroptions) {
    return new Promise(function (resolve, reject) {
        var parti;
        try {
            parti = checkpart(part);
        }
        catch (err) {
            reject(err);
        }
        var cmd = "mount " + parti.partition + " -o remount," + mode;
        if (otheroptions) {
            cmd + ',' + otheroptions;
        }
        child_process.exec("cat /etc/mtab | grep -c '" + part + "'", function (err, stdout, stderr) {
            if (err) {
                reject(err);
            }
            else if (parseInt(stdout) > 0) {
                child_process.exec(cmd, function (err, stdout, stderr) {
                    if (err) {
                        reject(err);
                    }
                    else {
                        resolve(true);
                    }
                });
            }
            else {
                reject("not mounted");
            }
        });
    });
}
exports.remount = remount;

//# sourceMappingURL=data:application/json;base64,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RyxHQUFHLFlBQVksQ0FBQTtRQUM1QixDQUFDO1FBR0QsYUFBYSxDQUFDLElBQUksQ0FBQywyQkFBMkIsR0FBRyxJQUFJLEdBQUcsR0FBRyxFQUFFLFVBQUMsR0FBRyxFQUFFLE1BQU0sRUFBRSxNQUFNO1lBQzdFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ04sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBQ2YsQ0FBQztZQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFFOUIsYUFBYSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsVUFBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLE1BQU07b0JBQ3hDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7d0JBQ04sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO29CQUNmLENBQUM7b0JBQUMsSUFBSSxDQUFDLENBQUM7d0JBQ0osT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBO29CQUNqQixDQUFDO2dCQUNMLENBQUMsQ0FBQyxDQUFBO1lBQ04sQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNKLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQTtZQUN6QixDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUE7SUFFTixDQUFDLENBQUMsQ0FBQTtBQUdOLENBQUM7QUFwQ2UsZUFBTyxVQW9DdEIsQ0FBQSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFByb21pc2UgZnJvbSBcImJsdWViaXJkXCI7XG5pbXBvcnQgKiBhcyBsc2Rpc2tzIGZyb20gXCJscy1kaXNrc1wiO1xuaW1wb3J0ICogYXMgY2hpbGRfcHJvY2VzcyBmcm9tIFwiY2hpbGRfcHJvY2Vzc1wiO1xuXG5cbmludGVyZmFjZSBJUGFydGl0aW9uIHtcbiAgICBwYXJ0aXRpb246IHN0cmluZztcbiAgICBzZWN0b3JzOiBudW1iZXI7XG4gICAgc2VjdG9yc19zdGFydDogbnVtYmVyO1xuICAgIHNlY3RvcnNfc3RvcDogbnVtYmVyO1xuICAgIHR5cGU6IHN0cmluZztcbiAgICBib290OiBib29sZWFuO1xuICAgIHNpemU6IG51bWJlcjtcbiAgICBsYWJlbD86IHN0cmluZztcbiAgICBuYW1lOiBzdHJpbmc7XG59XG5cblxuZnVuY3Rpb24gY2hlY2twYXJ0KHBhcnQ6IHN0cmluZyk6IElQYXJ0aXRpb24ge1xuXG4gICAgY29uc3QgZGlza3MgPSBsc2Rpc2tzLmFsbCgpO1xuXG4gICAgbGV0IHRoZXBhcnRpdGlvbjogSVBhcnRpdGlvbjtcbiAgICBsZXQgZXhpc3RzID0gZmFsc2U7XG4gICAgZm9yIChsZXQgZCA9IDA7IGQgPCBkaXNrcy5sZW5ndGg7IGQrKykge1xuICAgICAgICBmb3IgKGxldCBwID0gMDsgcCA8IGRpc2tzW2RdLnBhcnRpdGlvbnMubGVuZ3RoOyBwKyspIHtcbiAgICAgICAgICAgIGlmIChkaXNrc1tkXS5wYXJ0aXRpb25zW3BdLm5hbWUgPT09IHBhcnQgfHwgZGlza3NbZF0ucGFydGl0aW9uc1twXS5wYXJ0aXRpb24gPT09IHBhcnQgfHwgZGlza3NbZF0ucGFydGl0aW9uc1twXS5sYWJlbCA9PT0gcGFydCkge1xuICAgICAgICAgICAgICAgIHRoZXBhcnRpdGlvbiA9IGRpc2tzW2RdLnBhcnRpdGlvbnNbcF1cbiAgICAgICAgICAgICAgICBleGlzdHMgPSB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZXhpc3RzKSB7XG4gICAgICAgIHJldHVybiB0aGVwYXJ0aXRpb25cbiAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBFcnJvcihcInBhcnRpdGlvbiBcIiArIHBhcnQgKyBcIiBub3QgZm91bmRlZFwiKVxuICAgIH1cblxufVxuXG5leHBvcnQgZnVuY3Rpb24gbW91bnQocGFydDogc3RyaW5nLCBkaXI6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIC8vIG1hbmNhIGlsIGNvbnRyb2xsbyBkZWwgc2UgZ2nDoCDDqCBtb250YXRvXG4gICAgLy8gc2FyZWJiZSBpbiBvbHRyZSBwb3NzaWJpbGUgbW9udGFyZSBsYSBwYXJ0aXppb25lIHNlbnphIHNwZWNpZmljYXJlIGxhIGRpcmVjdG9yeSBxdWFsb3JhIGxhIHBhcnRpemlvbmUgZXNpc3RlIHN1bGwnZnN0YWJcbiAgICByZXR1cm4gbmV3IFByb21pc2U8Ym9vbGVhbj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBsZXQgcGFydGk6IElQYXJ0aXRpb247XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBwYXJ0aSA9IGNoZWNrcGFydChwYXJ0KVxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHJlamVjdChlcnIpXG4gICAgICAgIH1cblxuICAgICAgICBjaGlsZF9wcm9jZXNzLmV4ZWMoXCJtb3VudCBcIiArIHBhcnRpLnBhcnRpdGlvbiArIFwiIFwiICsgZGlyLCAoZXJyLCBzdGRvdXQsIHN0ZGVycikgPT4ge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuICAgIH0pXG5cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVtb3VudChkaXJPclBhcnQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIC8vIGlsIGNvbnRyb2xsbyBkZWwgbW91bnRwb2ludCDDqCBpbXByZWNpc29cblxuICAgIHJldHVybiBuZXcgUHJvbWlzZTxib29sZWFuPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cblxuICAgICAgICBjaGlsZF9wcm9jZXNzLmV4ZWMoXCJjYXQgL2V0Yy9tdGFiIHwgZ3JlcCAtYyAnXCIgKyBkaXJPclBhcnQgKyBcIidcIiwgKGVyciwgc3Rkb3V0LCBzdGRlcnIpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKVxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJzZUludChzdGRvdXQpID4gMCkge1xuXG4gICAgICAgICAgICAgICAgY2hpbGRfcHJvY2Vzcy5leGVjKFwidW1tb3VudCBcIiArIGRpck9yUGFydCwgKGVyciwgc3Rkb3V0LCBzdGRlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycilcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSlcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlamVjdChcIm5vdCBtb3VudGVkXCIpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSlcblxuXG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIHJlbW91bnQocGFydDogc3RyaW5nLCBtb2RlOiBzdHJpbmcsIG90aGVyb3B0aW9ucz86IHN0cmluZ1tdKTogUHJvbWlzZTxib29sZWFuPiB7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2U8Ym9vbGVhbj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBsZXQgcGFydGk6IElQYXJ0aXRpb247XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBwYXJ0aSA9IGNoZWNrcGFydChwYXJ0KVxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHJlamVjdChlcnIpXG4gICAgICAgIH1cbiAgICAgICAgbGV0IGNtZCA9IFwibW91bnQgXCIgKyBwYXJ0aS5wYXJ0aXRpb24gKyBcIiAtbyByZW1vdW50LFwiICsgbW9kZVxuXG4gICAgICAgIGlmIChvdGhlcm9wdGlvbnMpIHtcbiAgICAgICAgICAgIGNtZCArICcsJyArIG90aGVyb3B0aW9uc1xuICAgICAgICB9XG5cblxuICAgICAgICBjaGlsZF9wcm9jZXNzLmV4ZWMoXCJjYXQgL2V0Yy9tdGFiIHwgZ3JlcCAtYyAnXCIgKyBwYXJ0ICsgXCInXCIsIChlcnIsIHN0ZG91dCwgc3RkZXJyKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycilcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFyc2VJbnQoc3Rkb3V0KSA+IDApIHtcblxuICAgICAgICAgICAgICAgIGNoaWxkX3Byb2Nlc3MuZXhlYyhjbWQsIChlcnIsIHN0ZG91dCwgc3RkZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZWplY3QoXCJub3QgbW91bnRlZFwiKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgfSlcblxuXG59XG5cblxuXG5cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
